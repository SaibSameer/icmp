{"ast":null,"code":"// Authentication service for handling login, logout, and session management\nimport { API_CONFIG, AUTH_CONFIG } from '../config';\n\n/**\r\n * Handles API responses and throws errors for non-OK responses\r\n * @param {Response} response - The fetch Response object\r\n * @returns {Promise<any>} - The parsed response data\r\n * @throws {Error} - Throws an error with details from the response if not ok\r\n */\nconst handleApiResponse = async response => {\n  console.log('API Response Status:', response.status, response.statusText);\n  console.log('Response Headers:', Object.fromEntries(response.headers.entries()));\n\n  // Handle non-OK responses\n  if (!response.ok) {\n    // Try to get detailed error from response\n    try {\n      const errorData = await response.json();\n      console.error('Error response data:', errorData);\n      throw new Error(errorData.message || errorData.error || `API error: ${response.status}`);\n    } catch (jsonError) {\n      // If response isn't valid JSON, use status text\n      console.error('Error parsing response:', jsonError);\n      const errorText = await response.text();\n      console.error('Response text:', errorText);\n      throw new Error(`API error: ${response.status} ${response.statusText} - ${errorText}`);\n    }\n  }\n\n  // For successful responses, parse JSON or return empty object\n  try {\n    const data = await response.json();\n    console.log('API Response Data:', data);\n    return data;\n  } catch (error) {\n    // Some successful responses may not have a body (e.g., 204 No Content)\n    console.log('No JSON in successful response');\n    return {};\n  }\n};\n\n/**\r\n * Login with business and user credentials\r\n * @param {string} userId - User ID\r\n * @param {string} businessId - Business ID\r\n * @param {string} businessApiKey - Business API Key\r\n * @returns {Promise<Object>} - Login response data\r\n */\nexport const login = async (userId, businessId, businessApiKey) => {\n  try {\n    console.log('Login attempt with:', {\n      userId,\n      businessId,\n      businessApiKey: '***'\n    });\n    console.log('Login URL:', `${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.LOGIN}`);\n    const body = JSON.stringify({\n      userId,\n      businessId,\n      businessApiKey\n    });\n    console.log('Request body:', body);\n    const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.LOGIN}`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      },\n      credentials: 'include',\n      // Important for cookie\n      body: body\n    });\n    const data = await handleApiResponse(response);\n    if (data.success) {\n      console.log('Login successful, storing credentials');\n      // Store credentials in localStorage for persistent login\n      localStorage.setItem(AUTH_CONFIG.STORAGE_KEYS.USER_ID, userId);\n      localStorage.setItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_ID, businessId);\n      localStorage.setItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_API_KEY, businessApiKey);\n    } else {\n      console.error('Login response indicates failure:', data);\n    }\n    return data;\n  } catch (error) {\n    console.error('Login error:', error);\n    throw error;\n  }\n};\n\n/**\r\n * Logout and clear stored credentials\r\n */\nexport const logout = () => {\n  // Clear stored credentials\n  localStorage.removeItem(AUTH_CONFIG.STORAGE_KEYS.USER_ID);\n  localStorage.removeItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_ID);\n  localStorage.removeItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_API_KEY);\n  return {\n    success: true,\n    message: 'Logged out successfully'\n  };\n};\n\n/**\r\n * Check if user is logged in\r\n * @returns {boolean} - True if user is logged in\r\n */\nexport const isLoggedIn = () => {\n  const userId = localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.USER_ID);\n  const businessId = localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_ID);\n  const businessApiKey = localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_API_KEY);\n  return !!(userId && businessId && businessApiKey);\n};\n\n/**\r\n * Get stored credentials\r\n * @returns {Object} - Stored credentials\r\n */\nexport const getStoredCredentials = () => {\n  return {\n    userId: localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.USER_ID) || '',\n    businessId: localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_ID) || '',\n    businessApiKey: localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_API_KEY) || ''\n  };\n};\n\n/**\r\n * Get authentication headers for API requests\r\n * @returns {Object} - Headers object with authentication\r\n */\nexport const getAuthHeaders = () => {\n  const businessApiKey = localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_API_KEY);\n  if (!businessApiKey) {\n    throw new Error('No API key found. Please log in first.');\n  }\n  return {\n    'Content-Type': 'application/json',\n    'Accept': 'application/json',\n    'businessapikey': businessApiKey // Using lowercase to match what the backend expects\n  };\n};\n\n// Create a named export object\nconst authService = {\n  login,\n  logout,\n  isLoggedIn,\n  getStoredCredentials,\n  getAuthHeaders\n};\nexport default authService;","map":{"version":3,"names":["API_CONFIG","AUTH_CONFIG","handleApiResponse","response","console","log","status","statusText","Object","fromEntries","headers","entries","ok","errorData","json","error","Error","message","jsonError","errorText","text","data","login","userId","businessId","businessApiKey","BASE_URL","ENDPOINTS","LOGIN","body","JSON","stringify","fetch","method","credentials","success","localStorage","setItem","STORAGE_KEYS","USER_ID","BUSINESS_ID","BUSINESS_API_KEY","logout","removeItem","isLoggedIn","getItem","getStoredCredentials","getAuthHeaders","authService"],"sources":["C:/icmp_events_api/front-end/src/services/authService.js"],"sourcesContent":["// Authentication service for handling login, logout, and session management\r\nimport { API_CONFIG, AUTH_CONFIG } from '../config';\r\n\r\n/**\r\n * Handles API responses and throws errors for non-OK responses\r\n * @param {Response} response - The fetch Response object\r\n * @returns {Promise<any>} - The parsed response data\r\n * @throws {Error} - Throws an error with details from the response if not ok\r\n */\r\nconst handleApiResponse = async (response) => {\r\n  console.log('API Response Status:', response.status, response.statusText);\r\n  console.log('Response Headers:', Object.fromEntries(response.headers.entries()));\r\n  \r\n  // Handle non-OK responses\r\n  if (!response.ok) {\r\n    // Try to get detailed error from response\r\n    try {\r\n      const errorData = await response.json();\r\n      console.error('Error response data:', errorData);\r\n      throw new Error(errorData.message || errorData.error || `API error: ${response.status}`);\r\n    } catch (jsonError) {\r\n      // If response isn't valid JSON, use status text\r\n      console.error('Error parsing response:', jsonError);\r\n      const errorText = await response.text();\r\n      console.error('Response text:', errorText);\r\n      throw new Error(`API error: ${response.status} ${response.statusText} - ${errorText}`);\r\n    }\r\n  }\r\n  \r\n  // For successful responses, parse JSON or return empty object\r\n  try {\r\n    const data = await response.json();\r\n    console.log('API Response Data:', data);\r\n    return data;\r\n  } catch (error) {\r\n    // Some successful responses may not have a body (e.g., 204 No Content)\r\n    console.log('No JSON in successful response');\r\n    return {};\r\n  }\r\n};\r\n\r\n/**\r\n * Login with business and user credentials\r\n * @param {string} userId - User ID\r\n * @param {string} businessId - Business ID\r\n * @param {string} businessApiKey - Business API Key\r\n * @returns {Promise<Object>} - Login response data\r\n */\r\nexport const login = async (userId, businessId, businessApiKey) => {\r\n  try {\r\n    console.log('Login attempt with:', { userId, businessId, businessApiKey: '***' });\r\n    console.log('Login URL:', `${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.LOGIN}`);\r\n    \r\n    const body = JSON.stringify({\r\n      userId,\r\n      businessId,\r\n      businessApiKey\r\n    });\r\n    \r\n    console.log('Request body:', body);\r\n    \r\n    const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.LOGIN}`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Accept': 'application/json'\r\n      },\r\n      credentials: 'include', // Important for cookie\r\n      body: body\r\n    });\r\n\r\n    const data = await handleApiResponse(response);\r\n    \r\n    if (data.success) {\r\n      console.log('Login successful, storing credentials');\r\n      // Store credentials in localStorage for persistent login\r\n      localStorage.setItem(AUTH_CONFIG.STORAGE_KEYS.USER_ID, userId);\r\n      localStorage.setItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_ID, businessId);\r\n      localStorage.setItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_API_KEY, businessApiKey);\r\n    } else {\r\n      console.error('Login response indicates failure:', data);\r\n    }\r\n    \r\n    return data;\r\n  } catch (error) {\r\n    console.error('Login error:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Logout and clear stored credentials\r\n */\r\nexport const logout = () => {\r\n  // Clear stored credentials\r\n  localStorage.removeItem(AUTH_CONFIG.STORAGE_KEYS.USER_ID);\r\n  localStorage.removeItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_ID);\r\n  localStorage.removeItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_API_KEY);\r\n  \r\n  return { success: true, message: 'Logged out successfully' };\r\n};\r\n\r\n/**\r\n * Check if user is logged in\r\n * @returns {boolean} - True if user is logged in\r\n */\r\nexport const isLoggedIn = () => {\r\n  const userId = localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.USER_ID);\r\n  const businessId = localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_ID);\r\n  const businessApiKey = localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_API_KEY);\r\n  \r\n  return !!(userId && businessId && businessApiKey);\r\n};\r\n\r\n/**\r\n * Get stored credentials\r\n * @returns {Object} - Stored credentials\r\n */\r\nexport const getStoredCredentials = () => {\r\n  return {\r\n    userId: localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.USER_ID) || '',\r\n    businessId: localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_ID) || '',\r\n    businessApiKey: localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_API_KEY) || ''\r\n  };\r\n};\r\n\r\n/**\r\n * Get authentication headers for API requests\r\n * @returns {Object} - Headers object with authentication\r\n */\r\nexport const getAuthHeaders = () => {\r\n  const businessApiKey = localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.BUSINESS_API_KEY);\r\n  \r\n  if (!businessApiKey) {\r\n    throw new Error('No API key found. Please log in first.');\r\n  }\r\n  \r\n  return {\r\n    'Content-Type': 'application/json',\r\n    'Accept': 'application/json',\r\n    'businessapikey': businessApiKey  // Using lowercase to match what the backend expects\r\n  };\r\n};\r\n\r\n// Create a named export object\r\nconst authService = {\r\n  login,\r\n  logout,\r\n  isLoggedIn,\r\n  getStoredCredentials,\r\n  getAuthHeaders\r\n};\r\n\r\nexport default authService; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}