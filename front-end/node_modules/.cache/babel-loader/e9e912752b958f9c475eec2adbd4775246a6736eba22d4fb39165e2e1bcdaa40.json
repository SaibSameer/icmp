{"ast":null,"code":"// Global request cache to prevent duplicate API calls\nconst apiCache = {\n  cache: {},\n  get: function (url) {\n    var _this$cache$url;\n    return (_this$cache$url = this.cache[url]) === null || _this$cache$url === void 0 ? void 0 : _this$cache$url.data;\n  },\n  set: function (url, data, ttl = 60000) {\n    // Default TTL: 1 minute\n    this.cache[url] = {\n      data,\n      expiry: Date.now() + ttl\n    };\n  },\n  isValid: function (url) {\n    const item = this.cache[url];\n    return item && item.expiry > Date.now();\n  },\n  clear: function () {\n    this.cache = {};\n  }\n};\n\n// Get stored credentials\nconst getStoredCredentials = () => {\n  const businessId = localStorage.getItem('businessId');\n  const businessApiKey = localStorage.getItem('businessApiKey');\n  return {\n    businessId,\n    businessApiKey\n  };\n};\n\n// Cached fetch function\nexport const cachedFetch = async (url, options = {}, ttl = 60000) => {\n  // Get stored credentials\n  const {\n    businessId,\n    businessApiKey\n  } = getStoredCredentials();\n\n  // Add credentials to URL if not already present\n  let urlWithCredentials = url;\n  if (businessId && !url.includes('business_id=')) {\n    urlWithCredentials += (url.includes('?') ? '&' : '?') + `business_id=${businessId}`;\n  }\n  if (businessApiKey && !url.includes('api_key=')) {\n    urlWithCredentials += (urlWithCredentials.includes('?') ? '&' : '?') + `api_key=${businessApiKey}`;\n  }\n\n  // Add credentials to headers if not already present\n  const headers = {\n    'Content-Type': 'application/json',\n    'Accept': 'application/json',\n    ...(businessApiKey ? {\n      'Authorization': businessApiKey,\n      'X-API-Key': businessApiKey,\n      'API-Key': businessApiKey\n    } : {}),\n    ...options.headers\n  };\n  const cacheKey = urlWithCredentials + (options.body ? JSON.stringify(options.body) : '');\n\n  // Return cached data if available and not expired\n  if (!options.method || options.method === 'GET') {\n    if (apiCache.isValid(cacheKey)) {\n      console.log(`Using cached data for: ${urlWithCredentials}`);\n      return {\n        ok: true,\n        json: async () => apiCache.get(cacheKey)\n      };\n    }\n  }\n\n  // Perform the fetch with updated URL and headers\n  const response = await fetch(urlWithCredentials, {\n    ...options,\n    headers\n  });\n\n  // Cache the result for GET requests\n  if (response.ok && (!options.method || options.method === 'GET')) {\n    const data = await response.json();\n    apiCache.set(cacheKey, data, ttl);\n\n    // Return an object that mimics the fetch response\n    return {\n      ok: true,\n      json: async () => data\n    };\n  }\n  return response;\n};","map":{"version":3,"names":["apiCache","cache","get","url","_this$cache$url","data","set","ttl","expiry","Date","now","isValid","item","clear","getStoredCredentials","businessId","localStorage","getItem","businessApiKey","cachedFetch","options","urlWithCredentials","includes","headers","cacheKey","body","JSON","stringify","method","console","log","ok","json","response","fetch"],"sources":["C:/icmp_events_api/front-end/src/utils/fetchUtils.js"],"sourcesContent":["// Global request cache to prevent duplicate API calls\r\nconst apiCache = {\r\n  cache: {},\r\n  get: function(url) {\r\n    return this.cache[url]?.data;\r\n  },\r\n  set: function(url, data, ttl = 60000) { // Default TTL: 1 minute\r\n    this.cache[url] = {\r\n      data,\r\n      expiry: Date.now() + ttl\r\n    };\r\n  },\r\n  isValid: function(url) {\r\n    const item = this.cache[url];\r\n    return item && item.expiry > Date.now();\r\n  },\r\n  clear: function() {\r\n    this.cache = {};\r\n  }\r\n};\r\n\r\n// Get stored credentials\r\nconst getStoredCredentials = () => {\r\n  const businessId = localStorage.getItem('businessId');\r\n  const businessApiKey = localStorage.getItem('businessApiKey');\r\n  return { businessId, businessApiKey };\r\n};\r\n\r\n// Cached fetch function\r\nexport const cachedFetch = async (url, options = {}, ttl = 60000) => {\r\n  // Get stored credentials\r\n  const { businessId, businessApiKey } = getStoredCredentials();\r\n  \r\n  // Add credentials to URL if not already present\r\n  let urlWithCredentials = url;\r\n  if (businessId && !url.includes('business_id=')) {\r\n    urlWithCredentials += (url.includes('?') ? '&' : '?') + `business_id=${businessId}`;\r\n  }\r\n  if (businessApiKey && !url.includes('api_key=')) {\r\n    urlWithCredentials += (urlWithCredentials.includes('?') ? '&' : '?') + `api_key=${businessApiKey}`;\r\n  }\r\n  \r\n  // Add credentials to headers if not already present\r\n  const headers = {\r\n    'Content-Type': 'application/json',\r\n    'Accept': 'application/json',\r\n    ...(businessApiKey ? {\r\n      'Authorization': businessApiKey,\r\n      'X-API-Key': businessApiKey,\r\n      'API-Key': businessApiKey\r\n    } : {}),\r\n    ...options.headers\r\n  };\r\n  \r\n  const cacheKey = urlWithCredentials + (options.body ? JSON.stringify(options.body) : '');\r\n  \r\n  // Return cached data if available and not expired\r\n  if (!options.method || options.method === 'GET') {\r\n    if (apiCache.isValid(cacheKey)) {\r\n      console.log(`Using cached data for: ${urlWithCredentials}`);\r\n      return { \r\n        ok: true,\r\n        json: async () => apiCache.get(cacheKey)\r\n      };\r\n    }\r\n  }\r\n  \r\n  // Perform the fetch with updated URL and headers\r\n  const response = await fetch(urlWithCredentials, { ...options, headers });\r\n  \r\n  // Cache the result for GET requests\r\n  if (response.ok && (!options.method || options.method === 'GET')) {\r\n    const data = await response.json();\r\n    apiCache.set(cacheKey, data, ttl);\r\n    \r\n    // Return an object that mimics the fetch response\r\n    return {\r\n      ok: true,\r\n      json: async () => data\r\n    };\r\n  }\r\n  \r\n  return response;\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}